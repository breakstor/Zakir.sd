name: Auto Sync Sudanese Assistant

on:
  # 1. ØªÙØ¹ÙŠÙ„ ÙŠØ¯ÙˆÙŠ Ù…Ù† ÙˆØ§Ø¬Ù‡Ø© GitHub
  workflow_dispatch:
    inputs:
      chat_source:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø£Ùˆ Ø§Ù„Ù…ØµØ¯Ø±'
        required: true
        default: 'https://chat-source.com'
  
  # 2. ØªÙØ¹ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ ÙØªØ±Ø§Øª
  schedule:
    - cron: '0 */6 * * *'  # ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª
    - cron: '0 12 * * 1'   # ÙƒÙ„ Ø¥Ø«Ù†ÙŠÙ† Ø§Ù„Ø³Ø§Ø¹Ø© 12 Ø¸Ù‡Ø±Ø§Ù‹
  
  # 3. ØªÙØ¹ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ù…Ù„Ù Ù…Ø¹ÙŠÙ†
  push:
    paths:
      - 'sync-trigger.txt'

jobs:
  sync-project-files:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: ğŸ Ø¥Ø¹Ø¯Ø§Ø¯ Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
          cache: 'pip'
          
      - name: ğŸ“¦ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 pygithub
          
      - name: ğŸ”„ ØªØ´ØºÙŠÙ„ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
        run: |
          python scripts/sync_from_chat.py
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          CHAT_SOURCE: ${{ github.event.inputs.chat_source }}
          
      - name: ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .
          git diff --staged --quiet || git commit -m "ğŸ”„ Auto-sync: ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©"
          git push
